(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5479)}])},5479:function(e,t,n){"use strict";function r(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(u){return void n(u)}i.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}n.r(t),n.d(t,{default:function(){return S}});var a=n(4051),s=n.n(a),i=n(5893);function c(e){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0);var n=new Promise((function(e){t.onreadystatechange=function(){4===t.readyState&&200==t.status&&e(JSON.parse(t.responseText))}}));return t.send(null),n}var u=n(7294);let d,f;const l=new WeakMap,p=new WeakMap,v=new WeakMap,x=new WeakMap,m=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return p.get(e);if("objectStoreNames"===t)return e.objectStoreNames||v.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(w(this),t),g(l.get(this))}:function(...t){return g(e.apply(w(this),t))}:function(t,...n){const r=e.call(w(this),t,...n);return v.set(r,t.sort?t.sort():[t]),g(r)}}function y(e){return"function"===typeof e?b(e):(e instanceof IDBTransaction&&function(e){if(p.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)}));p.set(e,t)}(e),t=e,(d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,h):e);var t}function g(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(g(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&l.set(t,e)})).catch((()=>{})),m.set(t,e),t}(e);if(x.has(e))return x.get(e);const t=y(e);return t!==e&&(x.set(e,t),m.set(t,e)),t}const w=e=>m.get(e);function k(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(e,t),i=g(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(g(s.result),e.oldVersion,e.newVersion,g(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),i.then((e=>{a&&e.addEventListener("close",(()=>a())),o&&e.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),i}const E=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],I=new Map;function B(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(I.get(t))return I.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=D.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!E.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,o?"readwrite":"readonly");let s=a.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),o&&a.done]))[0]};return I.set(t,a),a}h=(e=>({...e,get:(t,n,r)=>B(t,n)||e.get(t,n,r),has:(t,n)=>!!B(t,n)||e.has(t,n)}))(h);var L="songs",j="lastUpdate";function S(e){e=null!==e?e:function(e){throw e}(new TypeError("Cannot destructure undefined"));var t=(0,u.useState)([]),n=t[0],r=t[1],a=(0,u.useState)(""),d=a[0],f=a[1],l=(0,u.useRef)(null),p=function(){var e=o(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d!==t.name){e.next=3;break}return f(""),e.abrupt("return");case 3:return e.next=5,c("/songs/".concat(t.file));case 5:l.current=e.sent,f(t.name);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=o(s().mark((function e(){var t,n,o,a,i,u,d,f,l,p,v,x,m,h,b,y,g,w,E;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("songs",1,{upgrade:function(e,t,n,r){var o=e.createObjectStore("songs",{keyPath:"name"});o.createIndex("firstLetter","firstLetter",{unique:!1}),o.createIndex("key","key",{unique:!1}),e.createObjectStore("lastUpdate",{keyPath:"name"})}});case 2:if(t=e.sent,!navigator.onLine){e.next=36;break}return a=N(t,j),i=a.store,u=a.tx,e.next=9,i.get("lastUpdate");case 9:if(e.t1=o=e.sent,e.t0=null===e.t1,e.t0){e.next=13;break}e.t0=void 0===o;case 13:if(!e.t0){e.next=17;break}e.t2=void 0,e.next=18;break;case 17:e.t2=o.lastUpdate;case 18:return n=e.t2,e.next=21,u.done;case 21:return e.next=23,c("/songs.json");case 23:if(d=e.sent,console.log(n,d.lastUpdate),n==d.lastUpdate){e.next=36;break}return f=N(t,L,"readwrite"),l=f.store,p=f.tx,e.next=29,Promise.all(d.songs.map((function(e){return l.put(e)})));case 29:return e.next=31,p.done;case 31:return v=N(t,j,"readwrite"),x=v.store,m=v.tx,e.next=34,x.put({name:"lastUpdate",lastUpdate:d.lastUpdate});case 34:return e.next=36,m.done;case 36:return h=IDBKeyRange.bound("A","Z"),b=N(t,L),y=b.store,g=b.tx,w=[],e.next=41,y.openCursor(h);case 41:E=e.sent;case 42:if(!E){e.next=49;break}return w.push(E.value),e.next=46,E.continue();case 46:E=e.sent,e.next=42;break;case 49:return r(w),e.next=52,g.done;case 52:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){v()})),(0,i.jsx)("main",{className:"w-full lg:box flex flex-col",children:n.map((function(e){return[(0,i.jsxs)("button",{className:"w-full py-3",onClick:function(){return p(e)},children:[e.name," ",e.key]},e.name),d===e.name&&(0,i.jsx)("div",{children:JSON.stringify(l.current)},"songKeys")]}))})}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"readonly",r=e.transaction(t,n,{durability:"strict"}),o=r.objectStore(t);return{store:o,tx:r}}}},function(e){e.O(0,[774,888,179],(function(){return t=8312,e(e.s=t);var t}));var t=e.O();_N_E=t}]);